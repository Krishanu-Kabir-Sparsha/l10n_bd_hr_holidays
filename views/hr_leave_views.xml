<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ENHANCED LEAVE REQUEST FORM VIEW -->
    <record id="hr_leave_view_form_enhanced" model="ir.ui.view">
        <field name="name">hr.leave.view.form.enhanced</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="hr_holidays.hr_leave_view_form"/>
        <field name="priority">50</field>
        <field name="arch" type="xml">
            
            <!-- Add related field for sandwich check -->
            <xpath expr="//field[@name='leave_type_request_unit']" position="after">
                <field name="l10n_bd_is_sandwich_type" invisible="1"/>
                <field name="l10n_bd_contains_sandwich_leaves" invisible="1"/>
            </xpath>

            <!-- Override holiday_status_id to show ALL leave types -->
            <!-- <xpath expr="//field[@name='holiday_status_id']" position="attributes">
                <attribute name="domain">[('company_id', 'in', [employee_company_id, False])]</attribute>
            </xpath> -->
            
            <!-- Add sandwich leave warning - DYNAMIC based on leave type -->
            <xpath expr="//div[@name='duration_warning']" position="before">
                <div class="alert alert-info my-2" role="alert" invisible="not l10n_bd_is_sandwich_type">
                    <i class="fa fa-info-circle"/>
                    <strong> Sandwich Rule Active: </strong> For this leave type, weekends and public holidays falling between consecutive leave days will be included in the duration calculation.
                </div>
            </xpath>
            
            <!-- Add quick action buttons -->
            <xpath expr="//header/button[@name='action_approve']" position="before">
                <button string="Quick Approve" 
                        name="action_approve_quick" 
                        type="object" 
                        class="btn-success"
                        invisible="state != 'confirm' or not can_approve"
                        groups="hr_holidays.group_hr_holidays_responsible"/>
            </xpath>
            
            <!-- Add refuse with reason button -->
            <xpath expr="//header/button[@name='action_refuse']" position="after">
                <button string="Refuse with Reason" 
                        name="action_refuse_with_reason" 
                        type="object" 
                        class="btn-warning"
                        invisible="state not in ('confirm', 'validate1', 'validate') or not can_approve"
                        groups="hr_holidays.group_hr_holidays_responsible"/>
            </xpath>
            
        </field>
    </record>
    
    <!-- ENHANCED LEAVE LIST VIEW -->
    <record id="hr_leave_view_tree_enhanced" model="ir.ui.view">
        <field name="name">hr.leave.view.tree.enhanced</field>
        <field name="model">hr.leave</field>
        <field name="inherit_id" ref="hr_holidays.hr_leave_view_tree"/>
        <field name="priority">50</field>
        <field name="arch" type="xml">
            
            <!-- Add sandwich indicator -->
            <xpath expr="//field[@name='duration_display']" position="after">
                <field name="l10n_bd_is_sandwich_type" string="Sandwich" widget="boolean" optional="hide"/>
            </xpath>
            
        </field>
    </record>

</odoo>